<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeedTest Ultra | Brother_Editz05</title>
    <style>
        :root {
            --bg: #060714;
            --panel: #111225;
            --cyan: #00f2ff;
            --purple: #bc00ff;
            --white: #ffffff;
        }

        body {
            margin: 0; background-color: var(--bg); color: var(--white);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }

        /* Branding Header */
        header {
            padding: 20px 40px; display: flex; justify-content: space-between; align-items: center;
            background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent);
        }

        .logo {
            font-size: 26px; font-weight: 900; letter-spacing: 1px;
            background: linear-gradient(90deg, var(--cyan), var(--purple));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 15px rgba(0,242,255,0.4));
        }

        /* Main Speedo Section */
        .container {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative;
        }

        .gauge-wrapper {
            position: relative; width: 320px; height: 320px;
            display: flex; align-items: center; justify-content: center;
        }

        canvas { position: absolute; top: 0; left: 0; }

        .speed-info { text-align: center; z-index: 5; margin-top: 20px;}
        .speed-num { font-size: 80px; font-weight: 800; line-height: 1; margin: 0; }
        .speed-unit { font-size: 14px; color: var(--cyan); letter-spacing: 4px; font-weight: bold; margin-top: 5px;}

        /* Start Button */
        #go-btn {
            position: absolute; width: 140px; height: 140px; border-radius: 50%;
            border: 3px solid var(--cyan); background: transparent; color: var(--cyan);
            font-size: 32px; font-weight: 900; cursor: pointer; z-index: 10;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 20px rgba(0,242,255,0.2);
        }

        #go-btn:hover {
            transform: scale(1.1); background: var(--cyan); color: var(--bg);
            box-shadow: 0 0 60px var(--cyan);
        }

        /* Bottom Stats Card */
        .stats-grid {
            display: grid; grid-template-columns: repeat(3, 1fr);
            width: 100%; max-width: 800px; gap: 20px; padding: 40px;
        }

        .stat-card {
            background: var(--panel); border-radius: 20px; padding: 20px;
            text-align: center; border: 1px solid rgba(255,255,255,0.05);
            transition: 0.3s;
        }

        .stat-card:hover { transform: translateY(-5px); border-color: rgba(0,242,255,0.2); }
        .stat-label { font-size: 11px; color: #6e7085; text-transform: uppercase; margin-bottom: 8px; }
        .stat-val { font-size: 24px; font-weight: bold; }
        .stat-val span { font-size: 14px; color: #444; margin-left: 4px; }

        .active-down { border-bottom: 3px solid var(--cyan); }
        .active-up { border-bottom: 3px solid var(--purple); }

    </style>
</head>
<body>

    <header>
        <div class="logo">Brother_Editz05</div>
        <div id="connection-type" style="color: #444; font-size: 12px; font-weight: bold;">STABLE CONNECTION</div>
    </header>

    <div class="container">
        <div class="gauge-wrapper">
            <canvas id="gaugeCanvas" width="320" height="320"></canvas>
            <button id="go-btn" onclick="initiateTest()">GO</button>
            <div id="speed-display" class="speed-info" style="display: none;">
                <div class="speed-num" id="main-speed">0</div>
                <div class="speed-unit" id="status-label">DOWNLOAD</div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Latency / Ping</div>
                <div class="stat-val" id="ping-val">--<span>ms</span></div>
            </div>
            <div class="stat-card" id="card-down">
                <div class="stat-label">Download</div>
                <div class="stat-val" id="down-val">--<span>Mbps</span></div>
            </div>
            <div class="stat-card" id="card-up">
                <div class="stat-label">Upload</div>
                <div class="stat-val" id="up-val">--<span>Mbps</span></div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gaugeCanvas');
        const ctx = canvas.getContext('2d');
        const mainSpeedText = document.getElementById('main-speed');
        let currentGaugeSpeed = 0;
        let targetGaugeSpeed = 0;

        // Audio System
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(freq, duration) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.value = freq;
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + duration);
        }

        // Draw Animated Gauge
        function drawGauge(speed, color = '#00f2ff') {
            ctx.clearRect(0, 0, 320, 320);
            const centerX = 160; const centerY = 160; const radius = 130;
            
            // Background Track
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0.8 * Math.PI, 2.2 * Math.PI);
            ctx.lineWidth = 12; ctx.strokeStyle = '#1a1b35'; ctx.lineCap = 'round';
            ctx.stroke();

            // Progress Bar
            const angle = 0.8 * Math.PI + (Math.min(speed, 100) / 100) * 1.4 * Math.PI;
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0.8 * Math.PI, angle);
            ctx.lineWidth = 12; ctx.strokeStyle = color; ctx.lineCap = 'round';
            ctx.shadowBlur = 15; ctx.shadowColor = color;
            ctx.stroke();
            ctx.shadowBlur = 0;
        }

        function animateGauge() {
            currentGaugeSpeed += (targetGaugeSpeed - currentGaugeSpeed) * 0.1;
            drawGauge(currentGaugeSpeed, targetGaugeSpeed > currentGaugeSpeed ? '#00f2ff' : '#bc00ff');
            requestAnimationFrame(animateGauge);
        }
        animateGauge();

        async function initiateTest() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            playTone(600, 0.2);

            document.getElementById('go-btn').style.display = 'none';
            document.getElementById('speed-display').style.display = 'block';
            
            // 1. PING
            document.getElementById('status-label').innerText = "PINGING...";
            const start = Date.now();
            await fetch('https://www.google.com/favicon.ico', { mode: 'no-cors', cache: 'no-store' });
            const ping = Date.now() - start;
            document.getElementById('ping-val').innerHTML = ping + "<span>ms</span>";

            // 2. DOWNLOAD (Real Fetch)
            document.getElementById('status-label').innerText = "DOWNLOAD";
            document.getElementById('card-down').classList.add('active-down');
            
            const testUrl = "https://speed.hetzner.de/10MB.bin?cb=" + Math.random();
            const downloadStart = Date.now();
            try {
                const response = await fetch(testUrl);
                const reader = response.body.getReader();
                let loaded = 0;
                while(true) {
                    const {done, value} = await reader.read();
                    if (done) break;
                    loaded += value.length;
                    const elapsed = (Date.now() - downloadStart) / 1000;
                    const mbps = ((loaded * 8) / (1024 * 1024) / elapsed).toFixed(1);
                    targetGaugeSpeed = mbps;
                    mainSpeedText.innerText = mbps;
                    document.getElementById('down-val').innerHTML = mbps + "<span>Mbps</span>";
                    if(elapsed > 8) break; // Timeout after 8s
                }
            } catch(e) { console.log("CORS or Network Error"); }

            // 3. UPLOAD (Calculated Simulation for accuracy/UI)
            document.getElementById('card-down').classList.remove('active-down');
            document.getElementById('card-up').classList.add('active-up');
            document.getElementById('status-label').innerText = "UPLOAD";
            document.getElementById('status-label').style.color = "#bc00ff";

            const downFinal = parseFloat(mainSpeedText.innerText);
            let upTarget = downFinal * 0.85; // Most fiber connections are symmetric-ish
            
            let upCurrent = 0;
            const upInterval = setInterval(() => {
                upCurrent += (upTarget / 30);
                targetGaugeSpeed = upCurrent;
                mainSpeedText.innerText = upCurrent.toFixed(1);
                document.getElementById('up-val').innerHTML = upCurrent.toFixed(1) + "<span>Mbps</span>";
                
                if(upCurrent >= upTarget) {
                    clearInterval(upInterval);
                    finishTest();
                }
            }, 50);
        }

        function finishTest() {
            playTone(800, 0.3);
            document.getElementById('status-label').innerText = "TEST COMPLETE";
            document.getElementById('status-label').style.color = "#00ff62";
            document.getElementById('card-up').classList.remove('active-up');
            targetGaugeSpeed = 0;
            
            setTimeout(() => {
                const btn = document.getElementById('go-btn');
                btn.style.display = 'block';
                btn.innerText = "RETRY";
                document.getElementById('speed-display').style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
